<!-- Topic Details Content -->
<div class="topic-details-content">
  <div class="content-container">
    <div class="topic-header">
      <button (click)="goBack()" class="back-button">
        <i class="icon-arrow-left"></i>
        <span class="back-text">Topics</span>
      </button>
      <h1>{{ topic }}</h1>
      @if (llmResponse() && !isRegenerating()) {
        <button (click)="startRegeneration()" class="header-regenerate-button">
          <i class="icon-refresh"></i>
          <span class="regen-text">Regenerate</span>
        </button>
      }
    </div>
    
    <!-- Regeneration mode notice -->
    @if (isRegenerating()) {
      <div class="regeneration-notice">
        <p>Choose how to regenerate the response</p>
      </div>
    }
      
    <!-- Auto-generation status - Show when pre-selected debater is generating -->
    @if (!hasGeneratedResponse() && selectedDebaterId() && isLoading()) {
      <div class="auto-generation-status">
        <div class="loading-spinner"></div>
        <p>Generating response with {{ getDebaterName() }}...</p>
      </div>
    }
    
    <!-- Manual generation prompt - Only show when no response and no pre-selected debater -->
    @if (!hasGeneratedResponse() && !selectedDebaterId() && !isLoading()) {
      <div class="generate-prompt">
        <button class="generate-btn" (click)="generateLLMResponse()">
          <i class="icon-generate"></i>
          Generate Response
        </button>
        <p class="prompt-text">Generate a response for this topic using the default assistant.</p>
      </div>
    }
      
      @if (isRegenerating() && !isLoading()) {
        <div class="regeneration-controls">
          <div class="regeneration-options">
            <label class="default-debater-option">
              <input 
                type="checkbox" 
                [checked]="useDefaultForRegeneration()"
                (change)="onDefaultDebaterToggle($event)"
              >
              <span class="checkbox-text">Use Default Assistant</span>
            </label>
          </div>
          <div class="regeneration-buttons">
            <button class="regenerate-btn" (click)="regenerateResponse()">
              <i class="icon-refresh"></i>
              Generate with {{ getRegenerationDebaterName() }}
            </button>
            <button class="cancel-btn" (click)="cancelRegeneration()">
              Cancel
            </button>
          </div>
        </div>
      }
    
    <div class="content-section">
      <!-- Loading State -->
      @if (isLoading()) {
        <div class="loading-card">
          <div class="loading-spinner"></div>
          <p>Generating response about "{{ topic }}"...</p>
        </div>
      }
      
      <!-- Error State -->
      @else if (error()) {
        <div class="error-card">
          <div class="error-content">
            <h3>Unable to Generate Response</h3>
            @if (!isLLMAvailable) {
              <p>The LLM service is currently unavailable. Please make sure Ollama is running.</p>
            } @else {
              <p>{{ error() }}</p>
            }
            <button (click)="regenerateResponse()" class="retry-button">
              <i class="icon-refresh"></i>
              Try Again
            </button>
          </div>
        </div>
      }
      
      <!-- Success State with LLM Response -->
      @else if (llmResponse()) {
        <div class="response-card">
          <div class="response-meta">
            <span class="model-badge">{{ llmResponse()?.model }}</span>
            <span class="timestamp">{{ llmResponse()?.timestamp | date:'medium' }}</span>
            @if (selectedDebaterId()) {
              <span class="debater-info">Generated by: <strong>{{ getDebaterName() }}</strong></span>
            }
          </div>
          
          <div class="response-content">
            <div class="response-text">{{ llmResponse()?.content }}</div>
          </div>
          
          @if (llmResponse()?.tokens) {
            <div class="token-info">
              <small>
                Tokens: {{ llmResponse()?.tokens?.total }} 
                ({{ llmResponse()?.tokens?.prompt }} prompt + {{ llmResponse()?.tokens?.completion }} completion)
              </small>
            </div>
          }
          
        </div>
      }
    </div>

  </div>
</div>

<!-- Scroll to Top Button -->
@if (showScrollToTop()) {
  <button 
    class="scroll-to-top-btn" 
    (click)="scrollToTop()"
    title="Scroll to top">
    <i class="icon-arrow-up"></i>
  </button>
}
